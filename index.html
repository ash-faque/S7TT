<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="S7 ME GECW TIME TABLE">
    <title>S7 TT</title>
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/img/180.png">
    <meta name="apple-mobile-web-app-status-bar" content="#FFE1C4">
    <meta name="theme-color" content="#FFE1C4">
    <style>

        *{ 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            user-select: none;
            font-family: monospace;
        }body{ 
            background: #000000;
            width: 100%; 
            min-height: 100vh; 
            padding: 30px 10px;
        }body div{ 
            margin: 50px 0; 
            border-color: #ffffff;
            border-style: ridge;
            border-width: 2px;
            color: #ffd900;
        }

        #time{
            text-align: center;
            padding: 10px 0;
        }#time h3{ font-size: xx-large; }
        #time h4{ font-size: large; }
        #time h5{ 
            color: #00ff88; 
            font-size: x-large;
            padding: 10px 0;
        }

        #ttd{
            width: 100%; 
        }#ttd h4{
            border: 1px solid #ffd900;
            color: #ffd900;
            width: 90%;
            height: 60px;
            padding: 20px;
            margin: 20px auto;
            text-align: center;
        }.over{
            background: #680000;
        }.now{
            background: #008371;
        }.next{
            background: #058800;
        }
        
        .img{
            width: 100%; 
        }.img img{ 
            display: none;
            width: 100%; 
            transition: 1000ms;
        }.img h3{
            display: block;
            padding: 5px;
            text-align: center;
            background: #272727;
            color: #ffd900;
            cursor: pointer;
        }
        

    </style>
</head>
<body>

    <div id="time"></div>
    <div id="ttd"></div>
    <div class="img">
        <img src="time_table.png" alt="S7 Time Table">
        <h3 onclick="SFTT(this)">TOGGLE FULL TIME TABLE</h3>
    </div>

    <script>
        // now time display
        let P = 0;
        const TD = document.getElementById('time');
        const DTN = () => {
            let T = new Date();
            let TSA = T.toDateString().split(' ');
            let H = T.getHours();
            let M = T.getMinutes();
            let S = T.getSeconds();
            if ((H <= 8) && (M <= 30)) P = 0;
            if (((H >= 8) && (M >= 30)) && ((H <= 9) && (M <= 10))) P = 1;
            if (((H >= 9) && (M >= 30)) && ((H <= 10) && (M <= 10))) P = 2;
            if (((H >= 10) && (M >= 30)) && ((H <= 11) && (M <= 10))) P = 3;
            if (((H >= 11) && (M >= 40)) && ((H <= 12) && (M <= 20))) P = 4;
            if (((H >= 12) && (M >= 40)) && ((H <= 13) && (M <= 20))) P = 5;
            if ((H >= 13) && (M >= 20)) P = 0;
            (P === 0) ? (PT = 'FREE TIME') : (PT = `PERIOD: ${P}`);
            TD.innerHTML = `<h3>${H} : ${M} : ${S}</h3>
            <h4>${TSA[0]} ${TSA[1]} ${TSA[2]} ${TSA[3]}</h4>
            <h5>${PT}</h5>`;
        };
        // tt displayer
        const TTD = document.getElementById('ttd');
        const DJTT = (TT) => {
            let D = (((new Date()).toDateString().split(' ')[0]).toString());
            let TTT = TT[D];
            // console.log(TTT)
            TTD.innerText = '';
            for (let i = 1; i <= 5; i ++){
                let h4 = document.createElement('h4');
                if (P > 0){
                    if (P < i) h4.classList.add('next');
                    if (P === i) h4.classList.add('now');
                    if (P > i) h4.classList.add('over');
                };
                h4.innerText = TTT[(i.toString())];
                TTD.appendChild(h4);
            };
        };
        // tt trigger
        const SFTT = (trigger) => {
            if (trigger.parentElement.querySelector('img').style.display == 'block'){
                trigger.parentElement.querySelector('img').style.display = 'none';
            } else {
                trigger.parentElement.querySelector('img').style.display = 'block';
            };
        };
        // onload
        window.onload = () => {
            if('serviceWorker' in navigator){
            navigator.serviceWorker.register('sw.js')
                        .then(reg => console.log('⚙ Service worker registered'))
                        .catch(err => console.log('⚙ Service worker not registered', err));
            };
            fetch('time_table.json')
                .then(r => {
                    r.json().then(j => {
                        // console.log(j)
                        setInterval(DTN, 1000);
                        setInterval(DJTT(j), 60*1000);
                    }).catch(e => {
                        console.log(e);
                    });
                }).catch(e => {
                    console.log(e);
                });
        };
    </script>

</html>